{
    "name": "vesting_logic_claim",
    "steps": [
        {
            "step": "scCall",
            "comment": "claim with non-existent beneficiary",
            "txId": "vesting_logic_claim#0",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "4",
                "message": "str:beneficiary does not exist",
                "gas": "*"
            }
        },
        {
            "step": "setState",
            "currentBlockInfo": {
                "blockTimestamp": "20000"
            }
        },
        {
            "step": "scCall",
            "comment": "add group info",
            "txId": "vesting_logic_claim#10",
            "tx": {
                "from": "address:multisig",
                "to": "sc:vesting",
                "function": "addGroup",
                "arguments": [
                    {
                        "group_type": "3"
                    },
                    {
                        "release_cliff": "u64:300"
                    },
                    {
                        "release_duration": "u64:500"
                    },
                    {
                        "release_percentage": "u8:20"
                    }
                ],
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "logs": "*"
            }
        },
        {
            "step": "scCall",
            "comment": "add revokable beneficiary info with start in future",
            "txId": "vesting_logic_claim#20",
            "tx": {
                "from": "address:multisig",
                "to": "sc:vesting",
                "function": "addBeneficiary",
                "arguments": [
                    {
                        "addr": "address:beneficiary_charlie"
                    },
                    {
                        "can_be_revoked": "true"
                    },
                    {
                        "group_type": "3"
                    },
                    {
                        "start": "u64:20000"
                    },
                    {
                        "tokens_allocated": "1,000,000"
                    }
                ],
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "logs": "*"
            }
        },
        {
            "step": "scCall",
            "comment": "claim (no available tokens)",
            "txId": "vesting_logic_claim#30",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "4",
                "message": "str:no tokens are available to be claimed",
                "gas": "*"
            }
        },
        {
            "step": "setState",
            "currentBlockInfo": {
                "blockTimestamp": "20300"
            }
        },
        {
            "step": "transfer",
            "comment": "supply vesting contract with ESDT",
            "txId": "vesting_logic_claim#35",
            "tx": {
                "from": "address:owner",
                "to": "sc:vesting",
                "egldValue": "0",
                "esdtValue": [
                    {
                        "tokenIdentifier": "str:TOK-0001",
                        "value": "100"
                    }
                ],
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#40",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "4",
                "message": "str:not enough tokens in vesting contract",
                "gas": "*"
            }
        },
        {
            "step": "transfer",
            "comment": "supply vesting contract with ESDT",
            "txId": "vesting_logic_claim#50",
            "tx": {
                "from": "address:owner",
                "to": "sc:vesting",
                "egldValue": "0",
                "esdtValue": [
                    {
                        "tokenIdentifier": "str:TOK-0001",
                        "value": "10,000,000,000"
                    }
                ],
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#60",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "logs": [
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:ESDTTransfer",
                        "topics": [
                            {
                                "token": "str:TOK-0001"
                            },
                            {
                                "?": ""
                            },
                            {
                                "value": "200,000"
                            },
                            {
                                "receiver": "address:beneficiary_charlie"
                            }
                        ],
                        "data": "0x"
                    },
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:claim",
                        "topics": [
                            {
                                "event": "str:claim"
                            },
                            {
                                "addr": "address:beneficiary_charlie"
                            },
                            {
                                "amount": "200,000"
                            }
                        ],
                        "data": ""
                    }
                ]
            }
        },
        {
            "step": "checkState",
            "comment": "assert TOK-0001 balance",
            "accounts": {
                "address:beneficiary_charlie": {
                    "storage": {
                        "+": ""
                    },
                    "esdt": {
                        "str:TOK-0001": "200,000"
                    }
                },
                "+": ""
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#70",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "4",
                "gas": "*",
                "message": "str:no tokens are available to be claimed"
            }
        },
        {
            "step": "setState",
            "currentBlockInfo": {
                "blockTimestamp": "21300"
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#80",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "logs": [
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:ESDTTransfer",
                        "topics": [
                            {
                                "token": "str:TOK-0001"
                            },
                            {
                                "?": ""
                            },
                            {
                                "value": "400,000"
                            },
                            {
                                "receiver": "address:beneficiary_charlie"
                            }
                        ],
                        "data": "0x"
                    },
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:claim",
                        "topics": [
                            {
                                "event": "str:claim"
                            },
                            {
                                "addr": "address:beneficiary_charlie"
                            },
                            {
                                "amount": "400,000"
                            }
                        ],
                        "data": ""
                    }
                ]
            }
        },
        {
            "step": "checkState",
            "comment": "assert TOK-0001 balance",
            "accounts": {
                "address:beneficiary_charlie": {
                    "storage": {
                        "+": ""
                    },
                    "esdt": {
                        "str:TOK-0001": "600,000"
                    }
                },
                "+": ""
            }
        },
        {
            "step": "setState",
            "currentBlockInfo": {
                "blockTimestamp": "21800"
            }
        },
        {
            "step": "scCall",
            "comment": "remove beneficiary",
            "txId": "vesting_logic_claim#90",
            "tx": {
                "from": "address:multisig",
                "to": "sc:vesting",
                "function": "removeBeneficiary",
                "arguments": [
                    {
                        "addr": "address:beneficiary_charlie"
                    }
                ],
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "refund": "*",
                "logs": [
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:removeBeneficiary",
                        "topics": [
                            {
                                "event": "str:remove_beneficiary"
                            },
                            {
                                "addr": "address:beneficiary_charlie"
                            }
                        ],
                        "data": ""
                    }
                ]
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#100",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "0",
                "gas": "*",
                "logs": [
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:ESDTTransfer",
                        "topics": [
                            {
                                "token": "str:TOK-0001"
                            },
                            {
                                "?": ""
                            },
                            {
                                "value": "200,000"
                            },
                            {
                                "receiver": "address:beneficiary_charlie"
                            }
                        ],
                        "data": "0x"
                    },
                    {
                        "address": "sc:vesting",
                        "endpoint": "str:claim",
                        "topics": [
                            {
                                "event": "str:claim"
                            },
                            {
                                "addr": "address:beneficiary_charlie"
                            },
                            {
                                "amount": "200,000"
                            }
                        ],
                        "data": ""
                    }
                ]
            }
        },
        {
            "step": "checkState",
            "comment": "assert TOK-0001 balance",
            "accounts": {
                "address:beneficiary_charlie": {
                    "storage": {
                        "+": ""
                    },
                    "esdt": {
                        "str:TOK-0001": "800,000"
                    }
                },
                "+": ""
            }
        },
        {
            "step": "setState",
            "currentBlockInfo": {
                "blockTimestamp": "22500"
            }
        },
        {
            "step": "scCall",
            "comment": "claim",
            "txId": "vesting_logic_claim#110",
            "tx": {
                "from": "address:beneficiary_charlie",
                "to": "sc:vesting",
                "function": "claim",
                "gasLimit": "5,000,000",
                "gasPrice": "0"
            },
            "expect": {
                "status": "4",
                "gas": "*",
                "message": "str:no tokens are available to be claimed"
            }
        }
    ]
}
